{{- define "title" -}}
{{ .Title }} - {{ .Site.Title }} | {{ .Site.Params.site }}
{{- end }}
{{- define "heading" -}}
GeschÃ¤fte in {{ .Title }}
{{- end }}
{{ define "main" }}
<section id="eintraege">
  <h2 class="visually-hidden">EintrÃ¤ge</h2>
  <div class="filter filter-entries">
    <div class="filter-box">
      <samp>{{ len .Pages }}</samp>
      <input type="text" placeholder="EintrÃ¤ge filtern..." aria-label="EintrÃ¤ge filtern...">
    </div>
    <button id="categories-btn" class="m-0" aria-label="Kategorien aufklappen">âž•</button>
  </div>
  <h2 class="visually-hidden">Kategorien</h2>
  <div class="categories d-none">
    {{- $shops := slice }}
    {{- range .RegularPages }}
    {{- $shops = $shops | append .Params.shop }}
    {{- end }}
    {{- $sortedShops := sort $shops | uniq }}
    <div class="filter filter-categories">
      <div class="filter-box">
        <samp>{{ len $sortedShops }}</samp>
        <input type="text" placeholder="Kategorien filtern..." aria-label="Kategorien filtern...">
      </div>
    </div>
    <div class="categories-items">
      {{- range $sortedShops }}
      {{- $sortedShop := . }}
      {{- range where ($.Site.GetPage "taxonomyTerm" "shops").Pages ".Title" . }}
      <button>{{ $sortedShop }}<svg class="icon" role="img" aria-hidden="true"><use href={{ printf "%s%s" "/img/sprite.svg#" .Params.icon | relURL }}></use></svg></button>
      {{- end }}
      {{- end }}
    </div>
  </div>
  <ul class="columns m-0">
  {{- $entries := slice }}
    {{- range .Pages }}
    {{- $dirs := split .File.Dir "/" }}
    {{- $main := index $dirs 0 }}
    {{- $city := index $dirs 1 }}
    {{- $location := index .Site.Data "cities" $city .File.BaseFileName }}
    {{- $street := $location.street }}
    {{- if not $street }}
    {{- $street = "(ohne StraÃŸe)" }}
    {{- end }}
    {{- $entry := dict "shop" .Params.shop "lat" $location.latitude "lon" $location.longitude "link" .RelPermalink "title" .Title "street" $street }}
    {{- $entries = $entries | append $entry }}
    {{- end }}
    {{- $doneEntries := slice }}
    {{- range $entries }}
    {{- $titleEntries := where $entries "title" .title }}
    {{- if (gt (len $titleEntries) 1) }}
    {{- if not (in $doneEntries .title) }}
    {{- $doneEntries = $doneEntries | append .title }}
    {{- range $titleEntries }}
    <li data-shop="{{ .shop }}" data-lat="{{ .lat }}" data-lon="{{ .lon }}"><a href="{{ .link }}">{{ .title }} - {{ .street }}</a></li>
    {{- end }}
    {{- end }}
    {{- else }}
    <li data-shop="{{ .shop }}" data-lat="{{ .lat }}" data-lon="{{ .lon }}"><a href="{{ .link }}">{{ .title }}</a></li>
    {{- end }}
    {{- end }}
  </ul>
  <p>Fehlt ein Eintrag? Trage ihn bitte in die freie Datenbank der <a href="https://www.openstreetmap.org/" rel="nofollow noopener">OpenStreetMap â†—</a> ein!</p>
</section>
<div class="row mt-1">
  <section class="col-md-6">
    <h2 class="visually-hidden">Karte</h2>
    <div id="map" class="is-overlay">
      {{ partialCached "load-btn.html" . -}}
      <a href="https://www.openstreetmap.org/search?query={{ .Title }}" rel="nofollow noopener">OpenStreetMap â†—</a>
      <a href="https://www.google.com/maps/dir//{{ .Title }}" rel="nofollow noopener">Google Maps â†—</a>
      {{ partialCached "locate-btn.html" . -}}
    </div>
  </section>
  <div class="col-md-6">
    {{ partialCached "chat.html" . -}}
  </div>
</div>
<article id="beschreibung" class="mt-1">
  <aside>
    <div class="row">
      <div class="col-sm-6">
        <p>{{ with .Content }}{{ . }}{{ else }}Es gibt noch keinen Text zur allgemeinen Einkaufslage in {{ .Title }}. Du kannst eine Beschreibung <a href="https://github.com/{{ .Site.Params.org }}/{{ .Site.Params.repo }}/edit/master/content/{{ with .File }}{{ .Dir }}{{ end }}_index.md" rel="nofollow noopener">hier â†—</a> eintragen ðŸ™‚{{ end }}</p>
      </div>
      <div class="col-sm-6">
        <p class="float-right-sm"><strong>Wetter in {{ .Title }}</strong></p>
        {{- $coordsLocation := .Title }}
        {{- if .Params.latitude }}
        {{- $coordsLocation = printf "%.2f,%.2f" .Params.latitude .Params.longitude }}
        {{- end }}
        <img loading="lazy" class="img-fluid float-right-sm" src="{{ printf "https://wttr.in/%s_0pQ_I_background=faebdc_lang=%s.png" $coordsLocation .Site.LanguageCode }}" alt="Das aktuelle Wetter in {{ .Title }}">
      </div>
    </div>
  </aside>
</article>
{{- end }}
{{- define "back" }}
<nav aria-label="Wechsle zu {{ .Site.Title }} oder springe nach oben">
  <ul>
    <li><a href="/{{ .Site.Params.repo }}/">â†¶ zurÃ¼ck zu {{ .Site.Title }}</a></li>
    <li><a href="#top">nach oben â†‘</a></li>
  </ul>
</nav>
{{- end }}